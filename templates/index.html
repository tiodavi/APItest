{% extends "base.html" %}

{% block content %}
<h1>查詢樂透紀錄</h1>
<form id="lotteryForm">
    <label for="drawType">開獎類型:</label>
    <select id="drawType">
        <option value="2">大樂透</option>
        <!-- 其他選項 -->
    </select>
    <br>
    <label for="drawYear">年份:</label>
    <input type="number" id="drawYear" value="2024">
    <br>
    <label for="drawMonth">月份:</label>
    <input type="number" id="drawMonth" value="11">
    <br>
    <button type="button" onclick="fetchLotteryData()">執行</button>
</form>

<div id="resultArea" style="margin-top: 2rem; width: 100%; max-width: 500px;">
    <table id="resultTable" style="display: none;">
        <thead>
            <tr>
                <th>開獎日期</th>
                <th>期數</th>
                <th>開獎號碼</th>
                <th>特別號</th>
                <th>兌獎期限</th>
            </tr>
        </thead>
        <tbody id="resultBody"></tbody>
    </table>
</div>
{% endblock %}

{% block scripts %}
<script>
    function fetchLotteryData() {
        const drawType = document.getElementById('drawType').value;
        const drawYear = document.getElementById('drawYear').value;
        const drawMonth = document.getElementById('drawMonth').value;

        const postData = {
            draw_type: parseInt(drawType),
            draw_year: parseInt(drawYear),
            draw_month: parseInt(drawMonth)
        };

        axios.post('/proxy', postData)
            .then((res) => {
                displayResults(res.data);
            })
            .catch((error) => {
                console.error('錯誤:', error);
                alert('請求失敗，請檢查控制台了解詳細信息');
            });
    }

    function displayResults(data) {
        const resultTable = document.getElementById('resultTable');
        const resultBody = document.getElementById('resultBody');
        resultBody.innerHTML = '';

        if (Array.isArray(data)) {
            data.forEach(item => {
                const row = document.createElement('tr');
                
                const dateCell = document.createElement('td');
                dateCell.textContent = item.draw_date;
                
                const periodCell = document.createElement('td');
                periodCell.textContent = item.period;
                
                const numbersCell = document.createElement('td');
                const regularNumbers = item.draw_number_appear.slice(0, -1);
                numbersCell.textContent = regularNumbers.join(', ');
                
                const specialCell = document.createElement('td');
                specialCell.textContent = item.draw_number_appear[item.draw_number_appear.length - 1];
                
                const redeemCell = document.createElement('td');
                redeemCell.textContent = item.redeemable_date;

                row.appendChild(dateCell);
                row.appendChild(periodCell);
                row.appendChild(numbersCell);
                row.appendChild(specialCell);
                row.appendChild(redeemCell);
                
                resultBody.appendChild(row);
            });

            resultTable.style.display = 'table';
        }
    }
</script>
{% endblock %}
